<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Source of the Rust file `relm4-examples/libadwaita/examples/advent_calendar.rs`."><meta name="keywords" content="rust, rustlang, rust-lang"><title>advent_calendar.rs - source</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled><link rel="stylesheet" type="text/css" href="../../dark.css" disabled><link rel="stylesheet" type="text/css" href="../../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../../storage.js"></script><script src="../../crates.js"></script><script defer src="../../main.js"></script><script defer src="../../source-script.js"></script><script defer src="../../source-files.js"></script>
    <noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../../favicon.svg"></head><body class="rustdoc source"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../../advent_calendar/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a><h2 class="location"></h2>
    </nav>
    <nav class="sidebar"><a class="sidebar-logo" href="../../advent_calendar/index.html"><div class="logo-container"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></div>
        </a></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../../advent_calendar/index.html"><img class="rust-logo" src="../../rust-logo.svg" alt="logo"></a><nav class="sub"><div class="theme-picker hidden"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu" title="themes"><img width="22" height="22" alt="Pick another theme!" src="../../brush.svg"></button><div id="theme-choices" role="menu"></div></div><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><button type="button" id="help-button" title="help">?</button><a id="settings-menu" href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../wheel.svg"></a></div></form></nav></div><section id="main-content" class="content"><div class="example-wrap"><pre class="line-numbers"><span id="1">1</span>
<span id="2">2</span>
<span id="3">3</span>
<span id="4">4</span>
<span id="5">5</span>
<span id="6">6</span>
<span id="7">7</span>
<span id="8">8</span>
<span id="9">9</span>
<span id="10">10</span>
<span id="11">11</span>
<span id="12">12</span>
<span id="13">13</span>
<span id="14">14</span>
<span id="15">15</span>
<span id="16">16</span>
<span id="17">17</span>
<span id="18">18</span>
<span id="19">19</span>
<span id="20">20</span>
<span id="21">21</span>
<span id="22">22</span>
<span id="23">23</span>
<span id="24">24</span>
<span id="25">25</span>
<span id="26">26</span>
<span id="27">27</span>
<span id="28">28</span>
<span id="29">29</span>
<span id="30">30</span>
<span id="31">31</span>
<span id="32">32</span>
<span id="33">33</span>
<span id="34">34</span>
<span id="35">35</span>
<span id="36">36</span>
<span id="37">37</span>
<span id="38">38</span>
<span id="39">39</span>
<span id="40">40</span>
<span id="41">41</span>
<span id="42">42</span>
<span id="43">43</span>
<span id="44">44</span>
<span id="45">45</span>
<span id="46">46</span>
<span id="47">47</span>
<span id="48">48</span>
<span id="49">49</span>
<span id="50">50</span>
<span id="51">51</span>
<span id="52">52</span>
<span id="53">53</span>
<span id="54">54</span>
<span id="55">55</span>
<span id="56">56</span>
<span id="57">57</span>
<span id="58">58</span>
<span id="59">59</span>
<span id="60">60</span>
<span id="61">61</span>
<span id="62">62</span>
<span id="63">63</span>
<span id="64">64</span>
<span id="65">65</span>
<span id="66">66</span>
<span id="67">67</span>
<span id="68">68</span>
<span id="69">69</span>
<span id="70">70</span>
<span id="71">71</span>
<span id="72">72</span>
<span id="73">73</span>
<span id="74">74</span>
<span id="75">75</span>
<span id="76">76</span>
<span id="77">77</span>
<span id="78">78</span>
<span id="79">79</span>
<span id="80">80</span>
<span id="81">81</span>
<span id="82">82</span>
<span id="83">83</span>
<span id="84">84</span>
<span id="85">85</span>
<span id="86">86</span>
<span id="87">87</span>
<span id="88">88</span>
<span id="89">89</span>
<span id="90">90</span>
<span id="91">91</span>
<span id="92">92</span>
<span id="93">93</span>
<span id="94">94</span>
<span id="95">95</span>
<span id="96">96</span>
<span id="97">97</span>
<span id="98">98</span>
<span id="99">99</span>
<span id="100">100</span>
<span id="101">101</span>
<span id="102">102</span>
<span id="103">103</span>
<span id="104">104</span>
<span id="105">105</span>
<span id="106">106</span>
<span id="107">107</span>
<span id="108">108</span>
<span id="109">109</span>
<span id="110">110</span>
<span id="111">111</span>
<span id="112">112</span>
<span id="113">113</span>
<span id="114">114</span>
<span id="115">115</span>
<span id="116">116</span>
<span id="117">117</span>
<span id="118">118</span>
<span id="119">119</span>
<span id="120">120</span>
<span id="121">121</span>
<span id="122">122</span>
<span id="123">123</span>
<span id="124">124</span>
<span id="125">125</span>
<span id="126">126</span>
<span id="127">127</span>
<span id="128">128</span>
<span id="129">129</span>
<span id="130">130</span>
<span id="131">131</span>
<span id="132">132</span>
<span id="133">133</span>
<span id="134">134</span>
<span id="135">135</span>
<span id="136">136</span>
<span id="137">137</span>
<span id="138">138</span>
<span id="139">139</span>
<span id="140">140</span>
<span id="141">141</span>
<span id="142">142</span>
<span id="143">143</span>
<span id="144">144</span>
<span id="145">145</span>
<span id="146">146</span>
<span id="147">147</span>
<span id="148">148</span>
<span id="149">149</span>
<span id="150">150</span>
<span id="151">151</span>
<span id="152">152</span>
<span id="153">153</span>
<span id="154">154</span>
<span id="155">155</span>
<span id="156">156</span>
<span id="157">157</span>
<span id="158">158</span>
<span id="159">159</span>
<span id="160">160</span>
<span id="161">161</span>
<span id="162">162</span>
<span id="163">163</span>
<span id="164">164</span>
<span id="165">165</span>
<span id="166">166</span>
<span id="167">167</span>
<span id="168">168</span>
<span id="169">169</span>
<span id="170">170</span>
<span id="171">171</span>
<span id="172">172</span>
<span id="173">173</span>
<span id="174">174</span>
<span id="175">175</span>
<span id="176">176</span>
<span id="177">177</span>
<span id="178">178</span>
<span id="179">179</span>
<span id="180">180</span>
<span id="181">181</span>
<span id="182">182</span>
<span id="183">183</span>
<span id="184">184</span>
<span id="185">185</span>
<span id="186">186</span>
<span id="187">187</span>
<span id="188">188</span>
<span id="189">189</span>
<span id="190">190</span>
<span id="191">191</span>
<span id="192">192</span>
<span id="193">193</span>
<span id="194">194</span>
<span id="195">195</span>
<span id="196">196</span>
<span id="197">197</span>
<span id="198">198</span>
<span id="199">199</span>
<span id="200">200</span>
<span id="201">201</span>
<span id="202">202</span>
<span id="203">203</span>
<span id="204">204</span>
<span id="205">205</span>
<span id="206">206</span>
<span id="207">207</span>
<span id="208">208</span>
<span id="209">209</span>
<span id="210">210</span>
<span id="211">211</span>
<span id="212">212</span>
<span id="213">213</span>
<span id="214">214</span>
<span id="215">215</span>
<span id="216">216</span>
<span id="217">217</span>
<span id="218">218</span>
<span id="219">219</span>
<span id="220">220</span>
<span id="221">221</span>
<span id="222">222</span>
<span id="223">223</span>
<span id="224">224</span>
<span id="225">225</span>
<span id="226">226</span>
<span id="227">227</span>
<span id="228">228</span>
<span id="229">229</span>
<span id="230">230</span>
<span id="231">231</span>
<span id="232">232</span>
<span id="233">233</span>
<span id="234">234</span>
<span id="235">235</span>
<span id="236">236</span>
<span id="237">237</span>
<span id="238">238</span>
<span id="239">239</span>
<span id="240">240</span>
<span id="241">241</span>
<span id="242">242</span>
<span id="243">243</span>
<span id="244">244</span>
<span id="245">245</span>
<span id="246">246</span>
<span id="247">247</span>
<span id="248">248</span>
<span id="249">249</span>
<span id="250">250</span>
<span id="251">251</span>
<span id="252">252</span>
<span id="253">253</span>
<span id="254">254</span>
<span id="255">255</span>
<span id="256">256</span>
<span id="257">257</span>
<span id="258">258</span>
<span id="259">259</span>
<span id="260">260</span>
<span id="261">261</span>
<span id="262">262</span>
<span id="263">263</span>
<span id="264">264</span>
<span id="265">265</span>
<span id="266">266</span>
<span id="267">267</span>
<span id="268">268</span>
<span id="269">269</span>
<span id="270">270</span>
<span id="271">271</span>
<span id="272">272</span>
<span id="273">273</span>
<span id="274">274</span>
<span id="275">275</span>
</pre><pre class="rust"><code><span class="kw">use</span> <span class="ident">adw::prelude::AdwApplicationWindowExt</span>;
<span class="kw">use</span> <span class="ident">gtk::glib::BindingFlags</span>;
<span class="kw">use</span> <span class="ident">gtk::prelude</span>::{<span class="ident">BoxExt</span>, <span class="ident">ButtonExt</span>, <span class="ident">GtkWindowExt</span>, <span class="ident">ObjectExt</span>, <span class="ident">OrientableExt</span>, <span class="ident">ToggleButtonExt</span>};

<span class="kw">use</span> <span class="ident">relm4</span>::{
    <span class="ident">adw</span>,
    <span class="ident">factory</span>::{<span class="ident">positions::StackPageInfo</span>, <span class="ident">FactoryPrototype</span>, <span class="ident">FactoryVec</span>},
    <span class="ident">gtk</span>, <span class="ident">send</span>, <span class="ident">AppUpdate</span>, <span class="ident">Model</span>, <span class="ident">RelmApp</span>, <span class="ident">Sender</span>, <span class="ident">WidgetPlus</span>, <span class="ident">Widgets</span>,
};

<span class="kw">use</span> <span class="ident">std::time</span>::{<span class="ident">SystemTime</span>, <span class="ident">UNIX_EPOCH</span>};

<span class="kw">fn</span> <span class="ident">waiting_text</span>(<span class="ident">time</span>: <span class="ident">u32</span>) -&gt; <span class="ident">String</span> {
    <span class="macro">format!</span>(
        <span class="string">&quot;You need to wait {} seconds before you can open this door.&quot;</span>,
        <span class="ident">time</span>
    )
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">struct</span> <span class="ident">CalendarEntry</span> {
    <span class="ident">verse</span>: <span class="ident">String</span>,
    <span class="ident">passage</span>: <span class="ident">String</span>,
    <span class="ident">time_left</span>: <span class="ident">u32</span>,
}

<span class="attribute">#[<span class="ident">derive</span>(<span class="ident">Debug</span>)]</span>
<span class="kw">struct</span> <span class="ident">CalendarWidgets</span> {
    <span class="ident">root</span>: <span class="ident">gtk::Stack</span>,
    <span class="ident">active</span>: <span class="ident">gtk::Box</span>,
    <span class="ident">waiting</span>: <span class="ident">gtk::CenterBox</span>,
    <span class="ident">waiting_label</span>: <span class="ident">gtk::Label</span>,
}

<span class="kw">impl</span> <span class="ident">CalendarWidgets</span> {
    <span class="comment">// Update widgets to new time</span>
    <span class="kw">fn</span> <span class="ident">update</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">time</span>: <span class="ident">u32</span>) {
        <span class="kw">if</span> <span class="ident">time</span> <span class="op">==</span> <span class="number">0</span> {
            <span class="self">self</span>.<span class="ident">root</span>.<span class="ident">set_visible_child</span>(<span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">active</span>);
        } <span class="kw">else</span> {
            <span class="self">self</span>.<span class="ident">waiting_label</span>.<span class="ident">set_label</span>(<span class="kw-2">&amp;</span><span class="ident">waiting_text</span>(<span class="ident">time</span>));
            <span class="self">self</span>.<span class="ident">root</span>.<span class="ident">set_visible_child</span>(<span class="kw-2">&amp;</span><span class="self">self</span>.<span class="ident">waiting</span>);
        }
    }
}

<span class="kw">impl</span> <span class="ident">FactoryPrototype</span> <span class="kw">for</span> <span class="ident">CalendarEntry</span> {
    <span class="kw">type</span> <span class="ident">Factory</span> <span class="op">=</span> <span class="ident">FactoryVec</span><span class="op">&lt;</span><span class="ident">CalendarEntry</span><span class="op">&gt;</span>;
    <span class="kw">type</span> <span class="ident">Widgets</span> <span class="op">=</span> <span class="ident">CalendarWidgets</span>;
    <span class="kw">type</span> <span class="ident">Root</span> <span class="op">=</span> <span class="ident">gtk::Stack</span>;
    <span class="kw">type</span> <span class="ident">View</span> <span class="op">=</span> <span class="ident">gtk::Stack</span>;
    <span class="kw">type</span> <span class="ident">Msg</span> <span class="op">=</span> <span class="ident">AppMsg</span>;

    <span class="kw">fn</span> <span class="ident">init_view</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">_key</span>: <span class="kw-2">&amp;</span><span class="ident">usize</span>, <span class="ident">_sender</span>: <span class="ident">Sender</span><span class="op">&lt;</span><span class="ident">AppMsg</span><span class="op">&gt;</span>) -&gt; <span class="ident"><span class="self">Self</span>::Widgets</span> {
        <span class="comment">// Create widgets.</span>
        <span class="kw">let</span> <span class="ident">root</span> <span class="op">=</span> <span class="ident">gtk::Stack::builder</span>()
            .<span class="ident">vexpand</span>(<span class="bool-val">true</span>)
            .<span class="ident">transition_type</span>(<span class="ident">gtk::StackTransitionType::RotateLeftRight</span>)
            .<span class="ident">transition_duration</span>(<span class="number">700</span>)
            .<span class="ident">build</span>();

        <span class="kw">let</span> <span class="ident">active</span> <span class="op">=</span> <span class="ident">gtk::Box::builder</span>()
            .<span class="ident">orientation</span>(<span class="ident">gtk::Orientation::Vertical</span>)
            .<span class="ident">spacing</span>(<span class="number">7</span>)
            .<span class="ident">valign</span>(<span class="ident">gtk::Align::Center</span>)
            .<span class="ident">halign</span>(<span class="ident">gtk::Align::Center</span>)
            .<span class="ident">build</span>();
        <span class="kw">let</span> <span class="ident">verse</span> <span class="op">=</span> <span class="ident">gtk::Label::builder</span>()
            .<span class="ident">label</span>(<span class="self">self</span>.<span class="ident">verse</span>.<span class="ident">as_str</span>())
            .<span class="ident">css_classes</span>(<span class="macro">vec!</span>[<span class="string">&quot;verse&quot;</span>.<span class="ident">to_string</span>()])
            .<span class="ident">wrap</span>(<span class="bool-val">true</span>)
            .<span class="ident">selectable</span>(<span class="bool-val">true</span>)
            .<span class="ident">build</span>();
        <span class="kw">let</span> <span class="ident">passage</span> <span class="op">=</span> <span class="ident">gtk::Label::builder</span>()
            .<span class="ident">label</span>(<span class="self">self</span>.<span class="ident">passage</span>.<span class="ident">as_str</span>())
            .<span class="ident">selectable</span>(<span class="bool-val">true</span>)
            .<span class="ident">halign</span>(<span class="ident">gtk::Align::End</span>)
            .<span class="ident">build</span>();

        <span class="kw">let</span> <span class="ident">waiting</span> <span class="op">=</span> <span class="ident">gtk::CenterBox::new</span>();
        <span class="kw">let</span> <span class="ident">waiting_label</span> <span class="op">=</span> <span class="ident">gtk::Label::new</span>(<span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="ident">waiting_text</span>(<span class="self">self</span>.<span class="ident">time_left</span>)));

        <span class="comment">// Connect widgets.</span>
        <span class="ident">active</span>.<span class="ident">append</span>(<span class="kw-2">&amp;</span><span class="ident">verse</span>);
        <span class="ident">active</span>.<span class="ident">append</span>(<span class="kw-2">&amp;</span><span class="ident">passage</span>);
        <span class="ident">active</span>.<span class="ident">set_margin_all</span>(<span class="number">30</span>);

        <span class="ident">waiting</span>.<span class="ident">set_center_widget</span>(<span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="ident">waiting_label</span>));

        <span class="ident">root</span>.<span class="ident">add_child</span>(<span class="kw-2">&amp;</span><span class="ident">active</span>);
        <span class="ident">root</span>.<span class="ident">add_child</span>(<span class="kw-2">&amp;</span><span class="ident">waiting</span>);

        <span class="kw">let</span> <span class="ident">widgets</span> <span class="op">=</span> <span class="ident">CalendarWidgets</span> {
            <span class="ident">root</span>,
            <span class="ident">waiting_label</span>,
            <span class="ident">waiting</span>,
            <span class="ident">active</span>,
        };
        <span class="ident">widgets</span>.<span class="ident">update</span>(<span class="self">self</span>.<span class="ident">time_left</span>);

        <span class="ident">widgets</span>
    }

    <span class="kw">fn</span> <span class="ident">position</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">key</span>: <span class="kw-2">&amp;</span><span class="ident">usize</span>) -&gt; <span class="ident">StackPageInfo</span> {
        <span class="ident">StackPageInfo</span> {
            <span class="ident">name</span>: <span class="prelude-val">Some</span>(<span class="ident">key</span>.<span class="ident">to_string</span>()),
            <span class="ident">title</span>: <span class="prelude-val">Some</span>(<span class="macro">format!</span>(<span class="string">&quot;Day {}&quot;</span>, <span class="ident">key</span> <span class="op">+</span> <span class="number">1</span>)),
        }
    }

    <span class="kw">fn</span> <span class="ident">view</span>(<span class="kw-2">&amp;</span><span class="self">self</span>, <span class="ident">_key</span>: <span class="kw-2">&amp;</span><span class="ident">usize</span>, <span class="ident">widgets</span>: <span class="kw-2">&amp;</span><span class="ident">CalendarWidgets</span>) {
        <span class="ident">widgets</span>.<span class="ident">update</span>(<span class="self">self</span>.<span class="ident">time_left</span>);
    }

    <span class="kw">fn</span> <span class="ident">root_widget</span>(<span class="ident">widgets</span>: <span class="kw-2">&amp;</span><span class="ident"><span class="self">Self</span>::Widgets</span>) -&gt; <span class="kw-2">&amp;</span><span class="ident"><span class="self">Self</span>::Root</span> {
        <span class="kw-2">&amp;</span><span class="ident">widgets</span>.<span class="ident">root</span>
    }
}

<span class="kw">struct</span> <span class="ident">AppModel</span> {
    <span class="ident">calendar_entries</span>: <span class="ident">FactoryVec</span><span class="op">&lt;</span><span class="ident">CalendarEntry</span><span class="op">&gt;</span>,
    <span class="ident">start_page</span>: <span class="ident">u8</span>,
}

<span class="kw">enum</span> <span class="ident">AppMsg</span> {
    <span class="ident">Update</span>,
}

<span class="kw">impl</span> <span class="ident">Model</span> <span class="kw">for</span> <span class="ident">AppModel</span> {
    <span class="kw">type</span> <span class="ident">Msg</span> <span class="op">=</span> <span class="ident">AppMsg</span>;
    <span class="kw">type</span> <span class="ident">Widgets</span> <span class="op">=</span> <span class="ident">AppWidgets</span>;
    <span class="kw">type</span> <span class="ident">Components</span> <span class="op">=</span> ();
}

<span class="kw">impl</span> <span class="ident">AppUpdate</span> <span class="kw">for</span> <span class="ident">AppModel</span> {
    <span class="kw">fn</span> <span class="ident">update</span>(<span class="kw-2">&amp;mut</span> <span class="self">self</span>, <span class="ident">msg</span>: <span class="ident">AppMsg</span>, <span class="ident">_components</span>: <span class="kw-2">&amp;</span>(), <span class="ident">_sender</span>: <span class="ident">Sender</span><span class="op">&lt;</span><span class="ident">AppMsg</span><span class="op">&gt;</span>) -&gt; <span class="ident">bool</span> {
        <span class="kw">match</span> <span class="ident">msg</span> {
            <span class="ident">AppMsg::Update</span> =&gt; {
                <span class="comment">// Check all entries</span>
                <span class="kw">for</span> <span class="ident">i</span> <span class="kw">in</span> <span class="number">0</span>..<span class="self">self</span>.<span class="ident">calendar_entries</span>.<span class="ident">len</span>() {
                    <span class="comment">// If counter &gt; 1, count down</span>
                    <span class="kw">let</span> <span class="ident">needs_update</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">calendar_entries</span>.<span class="ident">get</span>(<span class="ident">i</span>).<span class="ident">unwrap</span>().<span class="ident">time_left</span> <span class="op">!</span><span class="op">=</span> <span class="number">0</span>;

                    <span class="kw">if</span> <span class="ident">needs_update</span> {
                        <span class="kw">let</span> <span class="ident">entry</span> <span class="op">=</span> <span class="self">self</span>.<span class="ident">calendar_entries</span>.<span class="ident">get_mut</span>(<span class="ident">i</span>).<span class="ident">unwrap</span>();
                        <span class="ident">entry</span>.<span class="ident">time_left</span> <span class="op">=</span> <span class="ident">entry</span>.<span class="ident">time_left</span>.<span class="ident">saturating_sub</span>(<span class="number">1</span>);
                    }
                }
            }
        }
        <span class="bool-val">true</span>
    }
}

<span class="attribute">#[<span class="ident">relm4::widget</span>]</span>
<span class="kw">impl</span> <span class="ident">Widgets</span><span class="op">&lt;</span><span class="ident">AppModel</span>, ()<span class="op">&gt;</span> <span class="kw">for</span> <span class="ident">AppWidgets</span> {
    <span class="macro">view!</span> {
        <span class="ident">main_window</span> <span class="op">=</span> <span class="ident">adw::ApplicationWindow</span> {
            <span class="ident">set_default_width</span>: <span class="number">400</span>,
            <span class="ident">set_default_height</span>: <span class="number">240</span>,

            <span class="ident">set_content</span>: <span class="ident">main_box</span> <span class="op">=</span> <span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="ident">gtk::Box</span>) {
                <span class="ident">set_orientation</span>: <span class="ident">gtk::Orientation::Vertical</span>,

                <span class="ident">append</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="ident">adw::HeaderBar</span> {
                    <span class="ident">set_title_widget</span> <span class="op">=</span> <span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="ident">gtk::Label</span>) {
                        <span class="ident">set_label</span>: <span class="string">&quot;Relm4 advent calendar&quot;</span>,
                    },
                    <span class="ident">pack_start</span>: <span class="ident">flap_toggle</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="ident">gtk::ToggleButton</span> {
                        <span class="ident">set_label</span>: <span class="string">&quot;Expand&quot;</span>,
                        <span class="ident">set_icon_name</span>: <span class="string">&quot;sidebar-show&quot;</span>,
                    }
                },
                <span class="ident">append</span>: <span class="ident">flap</span> <span class="op">=</span> <span class="kw-2">&amp;</span><span class="ident">adw::Flap</span> {
                    <span class="ident">set_content</span>: <span class="ident">main_view</span> <span class="op">=</span> <span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="ident">gtk::Stack</span>) {
                        <span class="macro">factory!</span>(<span class="ident">model</span>.<span class="ident">calendar_entries</span>)
                    },
                    <span class="ident">set_flap</span> <span class="op">=</span> <span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="ident">gtk::StackSidebar</span>) {
                        <span class="ident">set_stack</span>: <span class="kw-2">&amp;</span><span class="ident">main_view</span>,
                    },
                    <span class="ident">set_separator</span> <span class="op">=</span> <span class="prelude-val">Some</span>(<span class="kw-2">&amp;</span><span class="ident">gtk::Separator</span>) {}
                }
            },
        }
    }

    <span class="comment">// Connect properties and start update thread.</span>
    <span class="kw">fn</span> <span class="ident">post_init</span>() {
        <span class="ident">flap_toggle</span>
            .<span class="ident">bind_property</span>(<span class="string">&quot;active&quot;</span>, <span class="kw-2">&amp;</span><span class="ident">flap</span>, <span class="string">&quot;reveal-flap&quot;</span>)
            .<span class="ident">flags</span>(<span class="ident">BindingFlags::BIDIRECTIONAL</span>)
            .<span class="ident">build</span>();

        <span class="ident">flap_toggle</span>.<span class="ident">set_active</span>(<span class="bool-val">true</span>);

        <span class="ident">main_view</span>.<span class="ident">set_visible_child_name</span>(<span class="kw-2">&amp;</span><span class="ident">model</span>.<span class="ident">start_page</span>.<span class="ident">to_string</span>());

        <span class="ident">std::thread::spawn</span>(<span class="kw">move</span> <span class="op">|</span><span class="op">|</span> <span class="kw">loop</span> {
            <span class="ident">std::thread::sleep</span>(<span class="ident">std::time::Duration::from_secs</span>(<span class="number">1</span>));
            <span class="macro">send!</span>(<span class="ident">sender</span>, <span class="ident">AppMsg::Update</span>);
        });
    }
}

<span class="kw">fn</span> <span class="ident">main</span>() {
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">calendar_entries</span> <span class="op">=</span> <span class="ident">FactoryVec::new</span>();
    <span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">start_page</span> <span class="op">=</span> <span class="number">0</span>;

    <span class="comment">// Time since midnight December the 1st.</span>
    <span class="kw">let</span> <span class="ident">time_since_first_dec</span> <span class="op">=</span> <span class="ident">SystemTime::now</span>()
        .<span class="ident">duration_since</span>(<span class="ident">UNIX_EPOCH</span>)
        .<span class="ident">unwrap</span>()
        .<span class="ident">as_secs</span>()
        <span class="op">-</span> <span class="number">1638313200</span>;
    <span class="kw">let</span> <span class="ident">seconds_per_day</span>: <span class="ident">i64</span> <span class="op">=</span> <span class="number">86400</span>;

    <span class="kw">let</span> <span class="ident">verses</span> <span class="op">=</span> <span class="macro">vec!</span>[
        (<span class="string">&quot;Come unto me, all ye that labour and are heavy laden, and I will give you rest. Take my yoke upon you, and learn of me; for I am meek and lowly in heart: and ye shall find rest unto your souls. For my yoke is easy, and my burden is light.&quot;</span>, <span class="string">&quot;Matthew 11, 28-30&quot;</span>),
        (<span class="string">&quot;For God so loved the world, that he gave his only begotten Son, that whosoever believeth in him should not perish, but have everlasting life. For God sent not his Son into the world to condemn the world; but that the world through him might be saved.&quot;</span>, <span class="string">&quot;John 3, 16-17&quot;</span>),
        (<span class="string">&quot;If any man thirst, let him come unto me, and drink. He that believeth on me, as the scripture hath said, out of his belly shall flow rivers of living water.&quot;</span>, <span class="string">&quot;John 8, 37-38&quot;</span>),
        (<span class="string">&quot;For the LORD God is a sun and shield: the LORD will give grace and glory: no good thing will he withhold from them that walk uprightly.&quot;</span>, <span class="string">&quot;Psalm 84, 11&quot;</span>),
        (<span class="string">&quot;Trust in the LORD with all thine heart; and lean not unto thine own understanding. In all thy ways acknowledge him, and he shall direct thy paths.&quot;</span>, <span class="string">&quot;Proverbs 3, 5-6&quot;</span>),
        (<span class="string">&quot;Blessed be the God and Father of our Lord Jesus Christ, who has blessed us with every spiritual blessing in the heavenly places in Christ, just as He chose us in Him before the foundation of the world, that we should be holy and without blame before Him in love.&quot;</span>, <span class="string">&quot;Ephesians 1,3-4&quot;</span>),
        (<span class="string">&quot;Jesus saith unto him, I am the way, the truth, and the life: no man cometh unto the Father, but by me.&quot;</span>, <span class="string">&quot;John 14, 6&quot;</span>),
        (<span class="string">&quot;Peace I leave with you, my peace I give unto you: not as the world giveth, give I unto you. Let not your heart be troubled, neither let it be afraid.&quot;</span>, <span class="string">&quot;John 14, 27&quot;</span>),
        (<span class="string">&quot;But the fruit of the Spirit is love, joy, peace, longsuffering, gentleness, goodness, faith, meekness, temperance: against such there is no law.&quot;</span>, <span class="string">&quot;Romans 8, 22-23&quot;</span>),
        (<span class="string">&quot;Then spake Jesus again unto them, saying, I am the light of the world: he that followeth me shall not walk in darkness, but shall have the light of life.&quot;</span>, <span class="string">&quot;John 8, 12&quot;</span>),
        (<span class="string">&quot;Rejoice in the Lord alway: and again I say, Rejoice. Let your moderation be known unto all men. The Lord is at hand.&quot;</span>, <span class="string">&quot;Philippians 4, 4-5&quot;</span>),
        (<span class="string">&quot;For the word of God is quick, and powerful, and sharper than any twoedged sword, piercing even to the dividing asunder of soul and spirit, and of the joints and marrow, and is a discerner of the thoughts and intents of the heart.&quot;</span>, <span class="string">&quot;Hebrews 4, 12&quot;</span>),
        (<span class="string">&quot;Commit to the Lord whatever you do, and he will establish your plans.&quot;</span>, <span class="string">&quot;Proverbs 16:3&quot;</span>),
        (<span class="string">&quot;Let the morning bring me word of your unfailing love, for I have put my trust in you. Show me the way I should go, for to you I entrust my life.&quot;</span>, <span class="string">&quot;Psalm 143:8&quot;</span>),
        (<span class="string">&quot;Be completely humble and gentle; be patient, bearing with one another in love.&quot;</span>, <span class="string">&quot;Ephesians 4:2&quot;</span>),
        (<span class="string">&quot;Whatever you do, work at it with all your heart, as working for the Lord, not for human masters, since you know that you will receive an inheritance from the Lord as a reward. It is the Lord Christ you are serving.&quot;</span>, <span class="string">&quot;Colossians 3:23-24&quot;</span>),
        (<span class="string">&quot;Let love and faithfulness never leave you;bind them around your neck, write them on the tablet of your heart. Then you will win favor and a good name in the sight of God and man.&quot;</span>, <span class="string">&quot;Proverbs 3:3-4&quot;</span>),
        (<span class="string">&quot;So do not fear, for I am with you; do not be dismayed, for I am your God. I will strengthen you and help you; I will uphold you with my righteous right hand.&quot;</span>, <span class="string">&quot;Isaiah 41:10&quot;</span>),
        (<span class="string">&quot;But blessed is the one who trusts in the Lord, whose confidence is in him. They will be like a tree planted by the water that sends out its roots by the stream. It does not fear when heat comes; its leaves are always green. It has no worries in a year of drought and never fails to bear fruit.&quot;</span>, <span class="string">&quot;Jeremiah 17:7-8&quot;</span>),
        (<span class="string">&quot;Love is patient, love is kind. It does not envy, it does not boast, it is not proud. It does not dishonor others, it is not self-seeking, it is not easily angered, it keeps no record of wrongs.&quot;</span>, <span class="string">&quot;1 Corinthians 13:4-5&quot;</span>),
        (<span class="string">&quot;Do not be anxious about anything, but in every situation, by prayer and petition, with thanksgiving, present your requests to God. And the peace of God, which transcends all understanding, will guard your hearts and your minds in Christ Jesus.&quot;</span>, <span class="string">&quot;Philippians 4:6-7&quot;</span>),
        (<span class="string">&quot;These commandments that I give you today are to be on your hearts. Impress them on your children. Talk about them when you sit at home and when you walk along the road, when you lie down and when you get up.&quot;</span>, <span class="string">&quot;Deuteronomy 6:6-7&quot;</span>),
        (<span class="string">&quot;But blessed is the one who trusts in the Lord, whose confidence is in him. They will be like a tree planted by the water that sends out its roots by the stream. It does not fear when heat comes; its leaves are always green. It has no worries in a year of drought and never fails to bear fruit.&quot;</span>, <span class="string">&quot;Jeremiah 17:7-8&quot;</span>),
        (<span class="string">&quot;The Lord bless you and keep you; the Lord make his face shine on you and be gracious to you; the Lord turn his face toward you and give you peace.&quot;</span>, <span class="string">&quot;Numbers 6:24-26&quot;</span>),
    ];

    <span class="comment">// Fill factory with the verses</span>
    <span class="kw">for</span> (<span class="ident">idx</span>, (<span class="ident">verse</span>, <span class="ident">passage</span>)) <span class="kw">in</span> <span class="ident">verses</span>.<span class="ident">iter</span>().<span class="ident">enumerate</span>() {
        <span class="kw">let</span> <span class="ident">time_difference</span> <span class="op">=</span> <span class="ident">seconds_per_day</span> <span class="op">*</span> <span class="ident">idx</span> <span class="kw">as</span> <span class="ident">i64</span> <span class="op">-</span> <span class="ident">time_since_first_dec</span> <span class="kw">as</span> <span class="ident">i64</span>;
        <span class="kw">let</span> <span class="ident">time_left</span> <span class="op">=</span> <span class="kw">if</span> <span class="ident">time_difference</span> <span class="op">&gt;</span> <span class="number">0</span> {
            <span class="ident">time_difference</span> <span class="kw">as</span> <span class="ident">u32</span>
        } <span class="kw">else</span> {
            <span class="ident">start_page</span> <span class="op">=</span> <span class="ident">idx</span> <span class="kw">as</span> <span class="ident">u8</span>;
            <span class="number">0</span>
        };

        <span class="ident">calendar_entries</span>.<span class="ident">push</span>(<span class="ident">CalendarEntry</span> {
            <span class="ident">verse</span>: <span class="ident">verse</span>.<span class="ident">to_string</span>(),
            <span class="ident">passage</span>: <span class="ident">passage</span>.<span class="ident">to_string</span>(),
            <span class="ident">time_left</span>,
        });
    }

    <span class="kw">let</span> <span class="ident">app</span> <span class="op">=</span> <span class="ident">RelmApp::new</span>(<span class="ident">AppModel</span> {
        <span class="ident">calendar_entries</span>,
        <span class="ident">start_page</span>,
    });

    <span class="comment">// Style the verse labels</span>
    <span class="ident">relm4::set_global_css</span>(
        <span class="string">b&quot;\
        .verse { \
            font-weight: bold; \
            font-size: 1.4em; \
        }&quot;</span>,
    );
    <span class="ident">app</span>.<span class="ident">run</span>();
}
</code></pre></div>
</section><section id="search" class="content hidden"></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-current-crate="advent_calendar" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.62.0-nightly (306ba8357 2022-04-05)" ></div>
</body></html>